<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml"
	horizontalAlign="center"
	paddingBottom="20"
	paddingTop="20"
	layout="vertical" title="New context"
	creationComplete="init()">
	<mx:Metadata>
		[Event(name="createContextClick", type="events.NewContextEvent")]
		[Event(name="cancelCreateContextClick", type="events.NewContextEvent")]
	</mx:Metadata>

	<mx:Script>
		<![CDATA[
			import mx.utils.ObjectProxy;
			import mx.collections.ArrayCollection;
			import mx.events.ItemClickEvent;
			import mx.utils.StringUtil;
			import events.NewContextEvent;
			
			private var rows:ArrayCollection = null;
			
			private function init(): void
			{
				objectsTextInput.setFocus();
			}
			
			private function sendCreateContext(objects:String, attributes:String, rows:ArrayCollection): void
			{
				var o:Array = objects.split(",").map(
					function(s:String, i:int, o:Array): String {
						return mx.utils.StringUtil.trim(s);
					});
				var a:Array = attributes.split(",").map(
					function(s:String, i:int, o:Array): String {
						return mx.utils.StringUtil.trim(s);
					});
				dispatchEvent(new NewContextEvent("createContextClick", o, a, rows));
			}
			
			private function createContext(): void
			{
				sendCreateContext(objectsTextInput.text, attributesTextInput.text, rows);
			}
			
			private function cancel(): void
			{
				dispatchEvent(new NewContextEvent("cancelCreateContextClick"));
			}
			
			private function clickHandler(event:ItemClickEvent): void
			{
				rows = null;
				objectsTextInput.text = objectArray[event.index]
				attributesTextInput.text = attributeArray[event.index];
			}

			private function contextClickHandler(event:ItemClickEvent): void
			{
				var model:ObjectProxy = (document[modelNamesArray[event.index]]);
				var objects:Array = model.obj as Array;
				var attributes:Array = model.attribute as Array
				objectsTextInput.text = objects.join(",");
				attributesTextInput.text = attributes.join(",");
				rows = new ArrayCollection();
				for each (var row:ObjectProxy in model.row)
				{
					rows.addItem(row.c as Array);
				}
				dispatchEvent(new NewContextEvent("createContextClick", objects, attributes, rows))
			}
		]]>
	</mx:Script>
	<mx:Model id="numbersModel" source="data/numbers.xml" />
	<mx:Label text="Please specify the objects and attributes of the context (separated by comma)" />
	<mx:Form xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%">
		<mx:FormItem label="Objects:" width="100%">
			<mx:TextInput width="100%" id="objectsTextInput"/>
		</mx:FormItem>
		<mx:FormItem label="Attributes:" width="100%">
			<mx:TextInput width="100%" id="attributesTextInput" enter="createContext()"/>
		</mx:FormItem>
	</mx:Form>
	<mx:Spacer height="10" />
	<mx:Label text="You may also choose a configuration from the following" />
	<mx:ButtonBar itemClick="clickHandler(event)">
		<mx:dataProvider>
			<mx:Array>
				<mx:String>Numbers</mx:String>
				<mx:String>Cars</mx:String>
				<mx:String>Phones</mx:String>
			</mx:Array>
		</mx:dataProvider>
	</mx:ButtonBar>
	<mx:Spacer height="10" />
	<mx:Label text="Or choose a complete context from the following" />
	<mx:ButtonBar itemClick="contextClickHandler(event)">
		<mx:dataProvider>
			<mx:Array>
				<mx:String>Numbers</mx:String>
			</mx:Array>
		</mx:dataProvider>
	</mx:ButtonBar>
	<mx:Spacer height="100%"/>
	<mx:ControlBar horizontalAlign="right">
		<mx:Button id="createButton" label="Create context" click="createContext()"/>
		<mx:Button label="Cancel" click="cancel()"/>
	</mx:ControlBar>
	<mx:Array id="objectArray">
		<mx:String>1,2,3,4,5,6,7,8,9,10</mx:String>
		<mx:String>Mustang,Corolla,Prius,Accord,Caliber</mx:String>
		<mx:String>E70,E71,3220,6600,TytnII</mx:String>
	</mx:Array>
	<mx:Array id="attributeArray">
		<mx:String>odd,even,composite,prime,square</mx:String>
		<mx:String>fast,cheap,nice,eco</mx:String>
		<mx:String>cheap,nice,rich,battery,signal</mx:String>
	</mx:Array>
	<mx:Array id="modelNamesArray">
		<mx:String>numbersModel</mx:String>
	</mx:Array>
</mx:Panel>
